<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title>sinter</title>
<style>
body {
  margin: 0px 0px 0px 0px;
  overflow-x: hidden;
  overflow-y: hidden;
}
</style>
<script type="text/javascript">
// are we overusing globals
var canv;
var g;
var winW = 0;
var winH = 0;
var cardBitCounts = [];
var deckOrig = [];
var deck = [];
var rowCounts = [];
var cardW = 0;
var cardH = 0;
// gfx settings
var cardBg = "#000";
var cardFg = "#FFF";
var winBg = "#070";
var omni = 24;
var bitW = 2 * omni;
var bitH = 2 * omni;
var propSpacing = omni;
var cardMarginW = omni;
var cardMarginH = omni;
var tableMarginW = omni;
var tableMarginH = omni;
var cardSepW = omni;
var cardSepH = omni;
function init() {
  initWin();
  initGameType();
  initGame();

  for (i = 0; i < 5; i++) {
    drawCard(deck[i], 
      tableMarginW + i * (cardW + cardSepW), 
      tableMarginH);
  }
}
function initWin() {
  canv = document.getElementById("canvas");
  winW = window.innerWidth;
  winH = window.innerWidth;
  canv.width = winW;
  canv.height = winH;
  g = canv.getContext("2d");
  g.fillStyle = winBg;
  g.fillRect(0, 0, winW, winH);
}
function initGameType() {
  // hardcoded
  cardBitCounts = [2, 5];
  // todo: generate
  rowCounts = [[2], [3, 2]];

  var b = [0, 1];
  deckOrig = arrSequence(
    map(function(x){return tail(arrSequence(replicate(x, b)));},
    cardBitCounts));

  cardH = cardMarginH * 2;
  var maxRowCount = 0;
  for (var i in rowCounts) {
    var counts = rowCounts[i];
    for (var j in counts) {
      count = counts[j];
      if (count > maxRowCount) {
        maxRowCount = count;
      }
      cardH += bitH;
    }
    cardH += propSpacing;
  }
  cardH -= propSpacing;
  cardW = maxRowCount * bitW + 2 * cardMarginW;
}
function initGame() {
  deck = arrCopy(deckOrig);
  shuffle(deck);
}
function drawCard(card, x, y) {
  g.fillStyle = cardBg;
  g.strokeStyle = cardFg;
  g.fillRect(x, y, cardW, cardH);
  g.strokeRect(x, y, cardW, cardH);

  var curY = cardMarginH;
  g.fillStyle = cardFg;
  g.strokeStyle = "#888";
  for (var i in rowCounts) {
    var counts = rowCounts[i];
    var curCol = 0;
    for (var j in counts) {
      var count = counts[j];
      for (var k = 0; k < count; k++) {
        var bitX = x + cardW / 2 + (k - count / 2) * bitW;
        if (card[i][curCol]) {
          g.fillRect(bitX, y + curY, bitW, bitH);
        }
        g.strokeRect(bitX, y + curY, bitW, bitH);
        curCol++;
      }
      curY += bitH;
    }
    curY += propSpacing;
  }
}
// a uniform random float in [a, b)
function randFloat(a, b) {
  return Math.random() * (b - a) + a;
}
// a uniform random int in [a, b]
function randInt(a, b) {
  return Math.floor(randFloat(a, b + 1));
}
function shuffle(a) {
  var i = a.length;
  if (i == 0) {
    return [];
  }
  while (--i) {
    var j = randInt(0, i);
    var tmp = a[i];
    a[i] = a[j];
    a[j] = tmp;
  }
}

//
// missing (i think) functions ported from haskell, and hacks
//

function arrSequence(arrs) {
  if (arrs.length == 0) {
    return [[]];
  }
  var arr0 = arrs[0];
  var seqRest = arrSequence(tail(arrs));
  var k = 0;
  var ret = [];
  for (var i in arr0) {
    for (var j in seqRest) {
      ret[k] = [arr0[i]].concat(seqRest[j]);
      k++;
    }
  }
  return ret;
}
function replicate(n, x) {
  var ret = [];
  for (var i = 0; i < n; i++) {
     ret[i] = x;
  }
  return ret;
}
function tail(l) {
  return l.slice(1);
}
function map(f, xs) {
  var ret = [];
  for (i in xs) {
    ret[i] = f(xs[i]);
  }
  return ret;
}
function concat(arrs) {
  if (arrs.length == 0) {
    return [];
  }
  return arrs[0].concat(concat(tail(arrs)));
}
function arrCopy(arr) {
  return arr.slice(0);
}
</script>
</head>
<body onload="init();" onmousedown="return false;">
<canvas id="canvas" width=0 height=0></canvas>
</body>
</html>
